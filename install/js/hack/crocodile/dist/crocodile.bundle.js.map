{"version":3,"file":"crocodile.bundle.js","sources":["../src/crocodile.js"],"sourcesContent":["import {Type, Dom, Loc, Event} from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { BitrixVue } from 'ui.vue3';\nimport './crocodile.css';\n\nexport class CrocodileApplication\n{\n\tconstructor(options = {})\n\t{\n\t\tif (Type.isStringFilled(options.rootNodeId))\n\t\t{\n\t\t\tthis.rootNode = document.getElementById(options.rootNodeId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error('CrocodileApplication: options.rootNodeId required')\n\t\t}\n\t}\n\n\tstart()\n\t{\n\t\tthis.attachTemplate();\n\t}\n\n\tattachTemplate()\n\t{\n\t\tBitrixVue.createApp({\n\t\t\tdata() {\n\t\t\t\treturn {\n\t\t\t\t\tchat: [],\n\t\t\t\t\tartistName: 'Художник',\n\t\t\t\t\troomId: null,\n\t\t\t\t\tuserId: null,\n\t\t\t\t\tisArtist: false,\n\t\t\t\t\tword: 'рекурсия',\n\t\t\t\t\timagePath: null,\n\t\t\t\t\tmessage: '',\n\n\t\t\t\t\ttool: 'brush',\n\t\t\t\t\tctx: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tmounted()\n\t\t\t{\n\t\t\t\tEventEmitter.subscribe('Hack.Crocodile:pictureUpdated', this.updateImage);\n\t\t\t\tBX.ajax.runAction('hack:crocodile.CrocodileController.getRoom').then(response => {\n\t\t\t\t\tconsole.log(response.data)\n\t\t\t\t\tthis.artistName = response.data.artistName;\n\t\t\t\t\tthis.roomId = response.data.roomId;\n\t\t\t\t\tthis.userId = response.data.userId;\n\t\t\t\t\tthis.isArtist = response.data.isArtist;\n\t\t\t\t\tthis.word = response.data.word;\n\t\t\t\t\tthis.imagePath = response.data.imagePath;\n\n\t\t\t\t\tBX.ajax.runAction('hack:crocodile.CrocodileController.getChat',{\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\troomId: this.roomId\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(r => {\n\t\t\t\t\t\tthis.chat = r.data;\n\t\t\t\t\t\tthis.$refs.crocodileChat.scrollTop = this.$refs.crocodileChat.scrollHeight;\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.ctx = this.$refs.crocodileCanvas.getContext(\"2d\");\n\t\t\t\t\tthis.ctx.fillStyle = \"#ffffff\";\n\t\t\t\t\tthis.ctx.rect(0, 0, this.$refs.crocodileCanvas.width, this.$refs.crocodileCanvas.height);\n\t\t\t\t\tthis.ctx.fill();\n\n\t\t\t\t\tthis.ctx.strokeStyle = \"#000000\";\n\t\t\t\t\tthis.ctx.lineCap = \"round\";\n\t\t\t\t\tthis.ctx.lineWidth = 4;\n\n\t\t\t\t\tthis.$refs.crocodileCanvas.onmousemove = (e) => {\n\t\t\t\t\t\tif (this.isArtist)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst x = e.offsetX;\n\t\t\t\t\t\t\tconst y = e.offsetY;\n\t\t\t\t\t\t\tconst dx = e.movementX;\n\t\t\t\t\t\t\tconst dy = e.movementY;\n\n\t\t\t\t\t\t\tif (e.buttons > 0) {\n\t\t\t\t\t\t\t\tthis.ctx.beginPath();\n\t\t\t\t\t\t\t\tthis.ctx.moveTo(x, y);\n\t\t\t\t\t\t\t\tthis.ctx.lineTo(x - dx, y - dy);\n\t\t\t\t\t\t\t\tthis.ctx.stroke();\n\t\t\t\t\t\t\t\tthis.ctx.closePath();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.$refs.crocodileCanvas.onmouseup = () => {\n\t\t\t\t\t\tthis.$refs.crocodileCanvas.toBlob((blob) => {\n\t\t\t\t\t\t\tlet file = new File([blob], \"crocodile.png\", { type: \"image/png\" });\n\t\t\t\t\t\t\tlet formData = new FormData();\n\t\t\t\t\t\t\tformData.append('crocodile.png', file);\n\t\t\t\t\t\t\tfetch('/uploadImage', {method: \"POST\", body: formData})\n\t\t\t\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\t\t\t\tEvent.EventEmitter.emit('Hack.Crocodile:pictureUpdated');\n\t\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t}, 'image/png');\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.$refs.chatForm.addEventListener('submit', (e) => {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tBX.ajax.runAction('hack:crocodile.CrocodileController.uploadMessage', {\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\troomId: this.roomId,\n\t\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\t\tmessage: this.message,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.message = '';\n\t\t\t\t\t});\n\n\t\t\t\t});\n\t\t\t},\n\t\t\tmethods: {\n\t\t\t\tselectBrush() {\n\t\t\t\t\tthis.tool = 'brush';\n\t\t\t\t\tthis.ctx.strokeStyle = \"#000000\";\n\t\t\t\t\tthis.ctx.lineWidth = 4;\n\t\t\t\t},\n\t\t\t\tselectErase() {\n\t\t\t\t\tthis.tool = 'erase';\n\t\t\t\t\tthis.ctx.strokeStyle = \"#ffffff\";\n\t\t\t\t\tthis.ctx.lineWidth = 16;\n\t\t\t\t},\n\t\t\t\tupdateImage() {\n\t\t\t\t\tconsole.log('12345')\n\t\t\t\t}\n\t\t\t},\n\t\t\tcomponents: {\n\t\t\t\t//Chat\n\t\t\t},\n\t\t\ttemplate: `\n\t\t\t\t<div class=\"crocodile-container\">\n\t\t\t\t\t<div class=\"artist-panel\" v-if=\"isArtist\">\n\t\t\t\t\t\t<button @click=\"selectBrush\">Brush</button>\n\t\t\t\t\t\t<button @click=\"selectErase\">Erase</button>\n\t\t\t\t\t\t<div class=\"selected-tool\">\n\t\t\t\t\t\t\tTool: {{tool}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"room-info\">\n\t\t\t\t\t\t<div class=\"room-artist\">{{artistName}}</div>\n\t\t\t\t\t\t<div class=\"room-word\" v-if=\"isArtist\">{{word}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crocodile-game\">\n\t\t\t\t\t\t<canvas ref=\"crocodileCanvas\" width=\"600\" height=\"400\"></canvas>\n\t\t\t\t\t\t<div class=\"crocodile-chat\">\n\t\t\t\t\t\t\t<div ref=\"crocodileChat\" class=\"crocodile-messages\">\n\t\t\t\t\t\t\t\t<div class=\"message\" v-for=\"msg of chat\">\n\t\t\t\t\t\t\t\t\t<div class=\"message-author\">{{msg.name}}</div>\n\t\t\t\t\t\t\t\t\t<div class=\"message-text\">{{msg.message}}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<form ref=\"chatForm\" class=\"crocodile-chat-form\" v-if=\"!isArtist\">\n\t\t\t\t\t\t\t\t<input type=\"text\" placeholder=\"Введите сообщение\" class=\"crocodile-input\" v-model=\"message\">\n\t\t\t\t\t\t\t\t<input type=\"submit\" value=\"отправить\">\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`\n\t\t}).mount(this.rootNode);\n\t}\n}\n"],"names":["CrocodileApplication","options","Type","isStringFilled","rootNodeId","rootNode","document","getElementById","Error","attachTemplate","BitrixVue","createApp","data","chat","artistName","roomId","userId","isArtist","word","imagePath","message","tool","ctx","mounted","EventEmitter","subscribe","updateImage","BX","ajax","runAction","then","response","console","log","r","$refs","crocodileChat","scrollTop","scrollHeight","crocodileCanvas","getContext","fillStyle","rect","width","height","fill","strokeStyle","lineCap","lineWidth","onmousemove","e","x","offsetX","y","offsetY","dx","movementX","dy","movementY","buttons","beginPath","moveTo","lineTo","stroke","closePath","onmouseup","toBlob","blob","file","File","type","formData","FormData","append","fetch","method","body","Event","emit","chatForm","addEventListener","preventDefault","methods","selectBrush","selectErase","components","template","mount"],"mappings":";;;;;KAKaA,oBAAb;CAEC,kCACA;CAAA,QADYC,OACZ,uEADsB,EACtB;CAAA;;CACC,QAAIC,cAAI,CAACC,cAAL,CAAoBF,OAAO,CAACG,UAA5B,CAAJ,EACA;CACC,WAAKC,QAAL,GAAgBC,QAAQ,CAACC,cAAT,CAAwBN,OAAO,CAACG,UAAhC,CAAhB;CACA,KAHD,MAKA;CACC,YAAM,IAAII,KAAJ,CAAU,mDAAV,CAAN;CACA;CACD;;CAZF;CAAA;CAAA,4BAeC;CACC,WAAKC,cAAL;CACA;CAjBF;CAAA;CAAA,qCAoBC;CACCC,MAAAA,iBAAS,CAACC,SAAV,CAAoB;CACnBC,QAAAA,IADmB,kBACZ;CACN,iBAAO;CACNC,YAAAA,IAAI,EAAE,EADA;CAENC,YAAAA,UAAU,EAAE,UAFN;CAGNC,YAAAA,MAAM,EAAE,IAHF;CAINC,YAAAA,MAAM,EAAE,IAJF;CAKNC,YAAAA,QAAQ,EAAE,KALJ;CAMNC,YAAAA,IAAI,EAAE,UANA;CAONC,YAAAA,SAAS,EAAE,IAPL;CAQNC,YAAAA,OAAO,EAAE,EARH;CAUNC,YAAAA,IAAI,EAAE,OAVA;CAWNC,YAAAA,GAAG,EAAE;CAXC,WAAP;CAaA,SAfkB;CAgBnBC,QAAAA,OAhBmB,qBAiBnB;CAAA;;CACCC,UAAAA,6BAAY,CAACC,SAAb,CAAuB,+BAAvB,EAAwD,KAAKC,WAA7D;CACAC,UAAAA,EAAE,CAACC,IAAH,CAAQC,SAAR,CAAkB,4CAAlB,EAAgEC,IAAhE,CAAqE,UAAAC,QAAQ,EAAI;CAChFC,YAAAA,OAAO,CAACC,GAAR,CAAYF,QAAQ,CAACnB,IAArB;CACA,YAAA,KAAI,CAACE,UAAL,GAAkBiB,QAAQ,CAACnB,IAAT,CAAcE,UAAhC;CACA,YAAA,KAAI,CAACC,MAAL,GAAcgB,QAAQ,CAACnB,IAAT,CAAcG,MAA5B;CACA,YAAA,KAAI,CAACC,MAAL,GAAce,QAAQ,CAACnB,IAAT,CAAcI,MAA5B;CACA,YAAA,KAAI,CAACC,QAAL,GAAgBc,QAAQ,CAACnB,IAAT,CAAcK,QAA9B;CACA,YAAA,KAAI,CAACC,IAAL,GAAYa,QAAQ,CAACnB,IAAT,CAAcM,IAA1B;CACA,YAAA,KAAI,CAACC,SAAL,GAAiBY,QAAQ,CAACnB,IAAT,CAAcO,SAA/B;CAEAQ,YAAAA,EAAE,CAACC,IAAH,CAAQC,SAAR,CAAkB,4CAAlB,EAA+D;CAC9DjB,cAAAA,IAAI,EAAE;CACLG,gBAAAA,MAAM,EAAE,KAAI,CAACA;CADR;CADwD,aAA/D,EAIGe,IAJH,CAIQ,UAAAI,CAAC,EAAI;CACZ,cAAA,KAAI,CAACrB,IAAL,GAAYqB,CAAC,CAACtB,IAAd;CACA,cAAA,KAAI,CAACuB,KAAL,CAAWC,aAAX,CAAyBC,SAAzB,GAAqC,KAAI,CAACF,KAAL,CAAWC,aAAX,CAAyBE,YAA9D;CACA,aAPD;CASA,YAAA,KAAI,CAAChB,GAAL,GAAW,KAAI,CAACa,KAAL,CAAWI,eAAX,CAA2BC,UAA3B,CAAsC,IAAtC,CAAX;CACA,YAAA,KAAI,CAAClB,GAAL,CAASmB,SAAT,GAAqB,SAArB;;CACA,YAAA,KAAI,CAACnB,GAAL,CAASoB,IAAT,CAAc,CAAd,EAAiB,CAAjB,EAAoB,KAAI,CAACP,KAAL,CAAWI,eAAX,CAA2BI,KAA/C,EAAsD,KAAI,CAACR,KAAL,CAAWI,eAAX,CAA2BK,MAAjF;;CACA,YAAA,KAAI,CAACtB,GAAL,CAASuB,IAAT;;CAEA,YAAA,KAAI,CAACvB,GAAL,CAASwB,WAAT,GAAuB,SAAvB;CACA,YAAA,KAAI,CAACxB,GAAL,CAASyB,OAAT,GAAmB,OAAnB;CACA,YAAA,KAAI,CAACzB,GAAL,CAAS0B,SAAT,GAAqB,CAArB;;CAEA,YAAA,KAAI,CAACb,KAAL,CAAWI,eAAX,CAA2BU,WAA3B,GAAyC,UAACC,CAAD,EAAO;CAC/C,kBAAI,KAAI,CAACjC,QAAT,EACA;CACC,oBAAMkC,CAAC,GAAGD,CAAC,CAACE,OAAZ;CACA,oBAAMC,CAAC,GAAGH,CAAC,CAACI,OAAZ;CACA,oBAAMC,EAAE,GAAGL,CAAC,CAACM,SAAb;CACA,oBAAMC,EAAE,GAAGP,CAAC,CAACQ,SAAb;;CAEA,oBAAIR,CAAC,CAACS,OAAF,GAAY,CAAhB,EAAmB;CAClB,kBAAA,KAAI,CAACrC,GAAL,CAASsC,SAAT;;CACA,kBAAA,KAAI,CAACtC,GAAL,CAASuC,MAAT,CAAgBV,CAAhB,EAAmBE,CAAnB;;CACA,kBAAA,KAAI,CAAC/B,GAAL,CAASwC,MAAT,CAAgBX,CAAC,GAAGI,EAApB,EAAwBF,CAAC,GAAGI,EAA5B;;CACA,kBAAA,KAAI,CAACnC,GAAL,CAASyC,MAAT;;CACA,kBAAA,KAAI,CAACzC,GAAL,CAAS0C,SAAT;CACA;CACD;CACD,aAhBD;;CAkBA,YAAA,KAAI,CAAC7B,KAAL,CAAWI,eAAX,CAA2B0B,SAA3B,GAAuC,YAAM;CAC5C,cAAA,KAAI,CAAC9B,KAAL,CAAWI,eAAX,CAA2B2B,MAA3B,CAAkC,UAACC,IAAD,EAAU;CAC3C,oBAAIC,IAAI,GAAG,IAAIC,IAAJ,CAAS,CAACF,IAAD,CAAT,EAAiB,eAAjB,EAAkC;CAAEG,kBAAAA,IAAI,EAAE;CAAR,iBAAlC,CAAX;CACA,oBAAIC,QAAQ,GAAG,IAAIC,QAAJ,EAAf;CACAD,gBAAAA,QAAQ,CAACE,MAAT,CAAgB,eAAhB,EAAiCL,IAAjC;CACAM,gBAAAA,KAAK,CAAC,cAAD,EAAiB;CAACC,kBAAAA,MAAM,EAAE,MAAT;CAAiBC,kBAAAA,IAAI,EAAEL;CAAvB,iBAAjB,CAAL,CACEzC,IADF,CACO,UAACC,QAAD,EAAc;CACnB8C,kBAAAA,eAAK,CAACrD,YAAN,CAAmBsD,IAAnB,CAAwB,+BAAxB;CACA,iBAHF;CAKA,eATD,EASG,WATH;CAUA,aAXD;;CAaA,YAAA,KAAI,CAAC3C,KAAL,CAAW4C,QAAX,CAAoBC,gBAApB,CAAqC,QAArC,EAA+C,UAAC9B,CAAD,EAAO;CACrDA,cAAAA,CAAC,CAAC+B,cAAF;CACAtD,cAAAA,EAAE,CAACC,IAAH,CAAQC,SAAR,CAAkB,kDAAlB,EAAsE;CACrEjB,gBAAAA,IAAI,EAAE;CACLG,kBAAAA,MAAM,EAAE,KAAI,CAACA,MADR;CAELC,kBAAAA,MAAM,EAAE,KAAI,CAACA,MAFR;CAGLI,kBAAAA,OAAO,EAAE,KAAI,CAACA;CAHT;CAD+D,eAAtE;CAOA,cAAA,KAAI,CAACA,OAAL,GAAe,EAAf;CACA,aAVD;CAYA,WAtED;CAuEA,SA1FkB;CA2FnB8D,QAAAA,OAAO,EAAE;CACRC,UAAAA,WADQ,yBACM;CACb,iBAAK9D,IAAL,GAAY,OAAZ;CACA,iBAAKC,GAAL,CAASwB,WAAT,GAAuB,SAAvB;CACA,iBAAKxB,GAAL,CAAS0B,SAAT,GAAqB,CAArB;CACA,WALO;CAMRoC,UAAAA,WANQ,yBAMM;CACb,iBAAK/D,IAAL,GAAY,OAAZ;CACA,iBAAKC,GAAL,CAASwB,WAAT,GAAuB,SAAvB;CACA,iBAAKxB,GAAL,CAAS0B,SAAT,GAAqB,EAArB;CACA,WAVO;CAWRtB,UAAAA,WAXQ,yBAWM;CACbM,YAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;CACA;CAbO,SA3FU;CA0GnBoD,QAAAA,UAAU,EAAE;CAAA,SA1GO;CA6GnBC,QAAAA,QAAQ;CA7GW,OAApB,EA2IGC,KA3IH,CA2IS,KAAKlF,QA3Id;CA4IA;CAjKF;CAAA;CAAA;;;;;;;;"}
{"version":3,"file":"crocodile.bundle.js","sources":["../src/crocodile.js"],"sourcesContent":["import {Type, Dom, Loc} from 'main.core';\nimport { BitrixVue } from 'ui.vue3';\nimport './crocodile.css';\n\nexport class CrocodileApplication\n{\n\tconstructor(options = {})\n\t{\n\t\tif (Type.isStringFilled(options.rootNodeId))\n\t\t{\n\t\t\tthis.rootNode = document.getElementById(options.rootNodeId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error('CrocodileApplication: options.rootNodeId required')\n\t\t}\n\t}\n\n\tstart()\n\t{\n\t\tthis.attachTemplate();\n\t}\n\n\tattachTemplate()\n\t{\n\t\tBitrixVue.createApp({\n\t\t\tdata() {\n\t\t\t\treturn {\n\t\t\t\t\tchat:\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t{name: 'Петр Попов', message: 'рекурсия'},\n\t\t\t\t\t\t\t{name: 'Артём Киселёв', message: 'массажное кресло'}\n\t\t\t\t\t\t],\n\t\t\t\t\tartistName: 'Художник',\n\t\t\t\t\troomId: null,\n\t\t\t\t\tisArtist: true,\n\t\t\t\t\tword: 'рекурсия',\n\t\t\t\t\timagePath: null,\n\n\t\t\t\t\ttool: 'brush',\n\t\t\t\t\tctx: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tmounted()\n\t\t\t{\n\t\t\t\tBX.ajax.runAction('hack:crocodile.CrocodileController.getRoom').then(response => {\n\t\t\t\t\tthis.artistName = response.data.artistName;\n\t\t\t\t\tthis.roomId = response.data.roomId;\n\t\t\t\t\tthis.isArtist = response.data.isArtist;\n\t\t\t\t\tthis.word = response.data.word;\n\t\t\t\t\tthis.imagePath = response.data.imagePath;\n\n\t\t\t\t\tBX.ajax.runAction('hack:crocodile.CrocodileController.getChat',{\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\troomId: this.roomId\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(r => {\n\t\t\t\t\t\tthis.chat = r.data.chat;\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t\tconst canvas = this.$refs.crocodileCanvas;\n\t\t\t\tthis.ctx = canvas.getContext(\"2d\");\n\n\t\t\t\tthis.ctx.fillStyle = \"#ffffff\";\n\t\t\t\tthis.ctx.rect(0, 0, canvas.width, canvas.height);\n\t\t\t\tthis.ctx.fill();\n\n\t\t\t\tthis.ctx.strokeStyle = \"#000000\";\n\t\t\t\tthis.ctx.lineCap = \"round\";\n\t\t\t\tthis.ctx.lineWidth = 4;\n\n\t\t\t\tcanvas.onmousemove = (e) => {\n\t\t\t\t\tconst x = e.offsetX;\n\t\t\t\t\tconst y = e.offsetY;\n\t\t\t\t\tconst dx = e.movementX;\n\t\t\t\t\tconst dy = e.movementY;\n\n\t\t\t\t\tif (e.buttons > 0) {\n\t\t\t\t\t\tthis.ctx.beginPath();\n\t\t\t\t\t\tthis.ctx.moveTo(x, y);\n\t\t\t\t\t\tthis.ctx.lineTo(x - dx, y - dy);\n\t\t\t\t\t\tthis.ctx.stroke();\n\t\t\t\t\t\tthis.ctx.closePath();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t},\n\t\t\tmethods: {\n\t\t\t\tselectBrush() {\n\t\t\t\t\tthis.tool = 'brush';\n\t\t\t\t\tthis.ctx.strokeStyle = \"#000000\";\n\t\t\t\t\tthis.ctx.lineWidth = 4;\n\t\t\t\t},\n\t\t\t\tselectErase() {\n\t\t\t\t\tthis.tool = 'erase';\n\t\t\t\t\tthis.ctx.strokeStyle = \"#ffffff\";\n\t\t\t\t\tthis.ctx.lineWidth = 16;\n\t\t\t\t},\n\t\t\t},\n\t\t\tcomponents: {\n\t\t\t\t//Chat\n\t\t\t},\n\t\t\ttemplate: `\n\t\t\t\t<div class=\"crocodile-container\">\n\t\t\t\t\t<div class=\"artist-panel\" v-if=\"isArtist\">\n\t\t\t\t\t\t<button @click=\"selectBrush\">Brush</button>\n\t\t\t\t\t\t<button @click=\"selectErase\">Erase</button>\n\t\t\t\t\t\t<div class=\"selected-tool\">\n\t\t\t\t\t\t\tTool: {{tool}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"room-info\">\n\t\t\t\t\t\t<div class=\"room-artist\">{{artistName}}</div>\n\t\t\t\t\t\t<div class=\"room-word\">{{word}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crocodile-game\">\n\t\t\t\t\t\t<canvas ref=\"crocodileCanvas\" width=\"600\" height=\"400\"></canvas>\n\t\t\t\t\t\t<div ref=\"crocodileChat\" class=\"crocodile-chat\">\n\t\t\t\t\t\t\t<div class=\"message\" v-for=\"msg of chat\">\n\t\t\t\t\t\t\t\t<div class=\"message-author\">{{msg.name}}</div>\n\t\t\t\t\t\t\t\t<div class=\"message-text\">{{msg.message}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`\n\t\t}).mount(this.rootNode);\n\t}\n}\n"],"names":["CrocodileApplication","options","Type","isStringFilled","rootNodeId","rootNode","document","getElementById","Error","attachTemplate","BitrixVue","createApp","data","chat","name","message","artistName","roomId","isArtist","word","imagePath","tool","ctx","mounted","BX","ajax","runAction","then","response","r","canvas","$refs","crocodileCanvas","getContext","fillStyle","rect","width","height","fill","strokeStyle","lineCap","lineWidth","onmousemove","e","x","offsetX","y","offsetY","dx","movementX","dy","movementY","buttons","beginPath","moveTo","lineTo","stroke","closePath","methods","selectBrush","selectErase","components","template","mount"],"mappings":"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"}